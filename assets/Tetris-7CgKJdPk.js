import{r as u,j as s}from"./index-DT6De0vj.js";import{P as a}from"./phaser-CtSIbetW.js";import{G as x,a as b}from"./GameOverScreen-DSWsITTW.js";const h=10,l=20,n=30,m=h*n,g=l*n,P=[65535,255,16753920,16776960,65280,16711680,8388736],f=[[[1,1,1,1]],[[1,0,0],[1,1,1]],[[0,0,1],[1,1,1]],[[1,1],[1,1]],[[0,1,1],[1,1,0]],[[0,1,0],[1,1,1]],[[1,1,0],[0,1,1]]];class S extends a.Scene{board=[];currentPiece;nextPiece;dropTimer=0;dropInterval=1e3;score=0;lines=0;level=1;isGameOver=!1;cursors;wasd;spaceKey;graphics;nextPieceGraphics;onScoreUpdate;onGameOver;constructor(e,t){super("TetrisScene"),this.onScoreUpdate=e,this.onGameOver=t}create(){this.board=Array.from({length:l},()=>Array(h).fill(null)),this.currentPiece=this.randomPiece(),this.nextPiece=this.randomPiece(),this.graphics=this.add.graphics(),this.nextPieceGraphics=this.add.graphics(),this.nextPieceGraphics.setPosition(m+20,100),this.cursors=this.input.keyboard.createCursorKeys(),this.wasd={w:this.input.keyboard.addKey(a.Input.Keyboard.KeyCodes.W),a:this.input.keyboard.addKey(a.Input.Keyboard.KeyCodes.A),s:this.input.keyboard.addKey(a.Input.Keyboard.KeyCodes.S),d:this.input.keyboard.addKey(a.Input.Keyboard.KeyCodes.D)},this.spaceKey=this.input.keyboard.addKey(a.Input.Keyboard.KeyCodes.SPACE),this.input.keyboard.on("keydown-LEFT",()=>this.move(-1,0)),this.input.keyboard.on("keydown-RIGHT",()=>this.move(1,0)),this.input.keyboard.on("keydown-DOWN",()=>this.move(0,1)),this.input.keyboard.on("keydown-UP",()=>this.rotate()),this.input.keyboard.on("keydown-A",()=>this.move(-1,0)),this.input.keyboard.on("keydown-D",()=>this.move(1,0)),this.input.keyboard.on("keydown-S",()=>this.move(0,1)),this.input.keyboard.on("keydown-W",()=>this.rotate()),this.input.keyboard.on("keydown-SPACE",()=>this.rotate()),this.draw()}randomPiece(){const e=a.Math.Between(0,f.length-1);return{shape:f[e],color:P[e],x:Math.floor(h/2)-1,y:0}}update(e,t){this.isGameOver||(this.dropTimer+=t,this.dropTimer>this.dropInterval&&(this.dropTimer=0,this.drop()))}drop(){this.collide(0,1)?(this.merge(),this.clearLines(),this.currentPiece=this.nextPiece,this.nextPiece=this.randomPiece(),this.collide(0,0)&&this.gameOver(),this.draw()):(this.currentPiece.y++,this.draw())}move(e,t){this.isGameOver||this.collide(e,t)||(this.currentPiece.x+=e,this.currentPiece.y+=t,t>0&&(this.score+=1,this.onScoreUpdate(this.score,this.lines,this.level)),this.draw())}rotate(){if(this.isGameOver)return;const e=this.currentPiece.shape[0].map((t,r)=>this.currentPiece.shape.map(i=>i[r]).reverse());this.collide(0,0,e)||(this.currentPiece.shape=e,this.draw())}collide(e,t,r=this.currentPiece.shape){for(let i=0;i<r.length;i++)for(let o=0;o<r[i].length;o++)if(r[i][o]){const p=this.currentPiece.x+o+e,c=this.currentPiece.y+i+t;if(p<0||p>=h||c>=l||c>=0&&this.board[c][p]!==null)return!0}return!1}merge(){for(let e=0;e<this.currentPiece.shape.length;e++)for(let t=0;t<this.currentPiece.shape[e].length;t++)if(this.currentPiece.shape[e][t]){const r=this.currentPiece.x+t,i=this.currentPiece.y+e;i>=0&&(this.board[i][r]=this.currentPiece.color)}}clearLines(){let e=0;for(let t=l-1;t>=0;t--)this.board[t].every(r=>r!==null)&&(this.board.splice(t,1),this.board.unshift(Array(h).fill(null)),e++,t++);e>0&&(this.lines+=e,this.score+=e*100*this.level,this.lines>=this.level*10&&(this.level++,this.dropInterval=Math.max(100,1e3-(this.level-1)*100)),this.onScoreUpdate(this.score,this.lines,this.level))}draw(){this.graphics.clear(),this.nextPieceGraphics.clear(),this.graphics.lineStyle(1,4473924,.3);for(let e=0;e<=h;e++)this.graphics.moveTo(e*n,0),this.graphics.lineTo(e*n,g);for(let e=0;e<=l;e++)this.graphics.moveTo(0,e*n),this.graphics.lineTo(m,e*n);this.graphics.strokePath();for(let e=0;e<l;e++)for(let t=0;t<h;t++)this.board[e][t]!==null&&this.drawBlock(this.graphics,t*n,e*n,this.board[e][t]);for(let e=0;e<this.currentPiece.shape.length;e++)for(let t=0;t<this.currentPiece.shape[e].length;t++)this.currentPiece.shape[e][t]&&this.drawBlock(this.graphics,(this.currentPiece.x+t)*n,(this.currentPiece.y+e)*n,this.currentPiece.color);for(let e=0;e<this.nextPiece.shape.length;e++)for(let t=0;t<this.nextPiece.shape[e].length;t++)this.nextPiece.shape[e][t]&&this.drawBlock(this.nextPieceGraphics,t*20,e*20,this.nextPiece.color,20)}drawBlock(e,t,r,i,o=n){e.fillStyle(i),e.fillRoundedRect(t,r,o-2,o-2,3),e.lineStyle(1,16777215,.3),e.strokeRoundedRect(t,r,o-2,o-2,3)}gameOver(){this.isGameOver=!0,this.onGameOver(this.score)}}const T=()=>{const[d,e]=u.useState("start"),[t,r]=u.useState({score:0,lines:0,level:1}),i=u.useRef(null);u.useEffect(()=>{if(d==="playing"){const p={type:a.AUTO,width:m+150,height:g,parent:"phaser-game",backgroundColor:"#1a1a2e",scene:new S((c,y,v)=>r({score:c,lines:y,level:v}),c=>{r(y=>({...y,score:c})),e("gameover")})};return i.current=new a.Game(p),()=>{i.current&&(i.current.destroy(!0),i.current=null)}}},[d]);const o=()=>{r({score:0,lines:0,level:1}),e("playing")};return d==="start"?s.jsx(x,{title:"üß© TETRIS",description:"¬°El cl√°sico juego de bloques que caen!",instructions:[{title:"Controles",items:["‚Üê ‚Üí A D: Mover pieza","‚Üì S: Ca√≠da r√°pida","‚Üë W Espacio: Rotar"],icon:"üéÆ"},{title:"Puntuaci√≥n",items:["L√≠neas completas: +100 √ó Nivel","Ca√≠da r√°pida: +1 punto","Cada 10 l√≠neas: +1 nivel"],icon:"üìä"}],onStart:o,theme:{primary:"#ff6b6b",secondary:"#4ecdc4",accent:"#45b7d1",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"}}):d==="gameover"?s.jsx(b,{score:t.score,onRestart:o,onMenu:()=>e("start"),theme:{primary:"#ff6b6b",secondary:"#4ecdc4",accent:"#45b7d1",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},customStats:[{label:"L√≠neas Completadas",value:t.lines},{label:"Nivel Alcanzado",value:t.level}]}):s.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",background:"linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)",minHeight:"100dvh",fontFamily:"Arial, sans-serif",color:"white"},children:[s.jsx("h1",{style:{margin:"0 0 20px 0",fontSize:"2.5rem"},children:"üß© TETRIS"}),s.jsxs("div",{style:{display:"flex",gap:"2rem",marginBottom:"1rem",fontSize:"1.2rem",fontWeight:"bold"},children:[s.jsxs("span",{children:["Score: ",t.score]}),s.jsxs("span",{children:["Lines: ",t.lines]}),s.jsxs("span",{children:["Level: ",t.level]})]}),s.jsxs("div",{style:{position:"relative"},children:[s.jsx("div",{id:"phaser-game",style:{border:"2px solid #444",borderRadius:"10px",overflow:"hidden"}}),s.jsx("div",{style:{position:"absolute",top:"80px",right:"30px",color:"white",fontSize:"16px",fontWeight:"bold"},children:"Next:"})]}),s.jsx("div",{style:{marginTop:"20px",fontSize:"1.2rem"},children:s.jsx("p",{children:"Use ‚Üê ‚Üí A D para mover, ‚Üì S para bajar r√°pido, ‚Üë W Espacio para rotar"})})]})};export{T as default};
