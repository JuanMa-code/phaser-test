import{r as y,j as o}from"./index-DT6De0vj.js";import{P as p}from"./phaser-CtSIbetW.js";import{G as b,a as C}from"./GameOverScreen-DSWsITTW.js";const m=900,u=700,i=50,w=18,v=14,h=[{x:0,y:7},{x:1,y:7},{x:2,y:7},{x:3,y:7},{x:3,y:6},{x:3,y:5},{x:3,y:4},{x:3,y:3},{x:4,y:3},{x:5,y:3},{x:6,y:3},{x:7,y:3},{x:8,y:3},{x:9,y:3},{x:9,y:4},{x:9,y:5},{x:9,y:6},{x:9,y:7},{x:9,y:8},{x:9,y:9},{x:8,y:9},{x:7,y:9},{x:6,y:9},{x:5,y:9},{x:5,y:8},{x:5,y:7},{x:5,y:6},{x:6,y:6},{x:7,y:6},{x:8,y:6},{x:9,y:6},{x:10,y:6},{x:11,y:6},{x:12,y:6},{x:13,y:6},{x:14,y:6},{x:14,y:5},{x:14,y:4},{x:14,y:3},{x:14,y:2},{x:15,y:2},{x:16,y:2},{x:17,y:2}],f={cannon:{cost:20,range:150,damage:20,cooldown:1e3,color:9127187,name:"CaÃ±Ã³n"},laser:{cost:35,range:200,damage:10,cooldown:300,color:16711680,name:"LÃ¡ser"},ice:{cost:30,range:125,damage:5,cooldown:800,color:65535,name:"Hielo"},poison:{cost:40,range:175,damage:5,cooldown:1500,color:9498256,name:"Veneno"}},G={normal:{hp:50,speed:100,bounty:2,color:16729156},fast:{hp:30,speed:150,bounty:3,color:4521796},tank:{hp:150,speed:60,bounty:5,color:4474111},boss:{hp:500,speed:40,bounty:15,color:16729343}};class j extends p.GameObjects.Container{hp;maxHp;speed;bounty;pathIndex=0;frozen=!1;poisoned=!1;pathTarget;hpBar;constructor(e,t,s){super(e,h[0].x*i+i/2,h[0].y*i+i/2);const a=G[t];this.hp=a.hp*s,this.maxHp=this.hp,this.speed=a.speed,this.bounty=a.bounty,this.pathTarget=h[1];const n=e.add.circle(0,0,15,a.color);this.add(n),this.hpBar=e.add.graphics(),this.add(this.hpBar),this.updateHpBar(),e.add.existing(this),e.physics.add.existing(this)}update(e,t){if(this.pathIndex>=h.length-1)return;const s=this.pathTarget.x*i+i/2,a=this.pathTarget.y*i+i/2,n=s-this.x,c=a-this.y,r=Math.sqrt(n*n+c*c),x=(this.frozen?this.speed*.5:this.speed)*t/1e3;r<=x?(this.x=s,this.y=a,this.pathIndex++,this.pathIndex<h.length&&(this.pathTarget=h[this.pathIndex])):(this.x+=n/r*x,this.y+=c/r*x),this.updateHpBar()}takeDamage(e){return this.hp-=e,this.hp<=0?(this.destroy(),!0):!1}updateHpBar(){this.hpBar.clear(),this.hpBar.fillStyle(16711680),this.hpBar.fillRect(-15,-25,30,5),this.hpBar.fillStyle(65280),this.hpBar.fillRect(-15,-25,30*(this.hp/this.maxHp),5)}}class E extends p.GameObjects.Container{type;level=1;range;damage;cooldown;lastFired=0;rangeCircle;constructor(e,t,s,a){super(e,t*i+i/2,s*i+i/2),this.type=a;const n=f[a];this.range=n.range,this.damage=n.damage,this.cooldown=n.cooldown;const c=e.add.circle(0,0,20,4473924),r=e.add.circle(0,0,15,n.color);this.add([c,r]),this.rangeCircle=e.add.graphics(),this.rangeCircle.lineStyle(2,16777215,.3),this.rangeCircle.strokeCircle(0,0,this.range),this.rangeCircle.setVisible(!1),this.add(this.rangeCircle),this.setInteractive(new p.Geom.Circle(0,0,20),p.Geom.Circle.Contains),this.on("pointerdown",()=>{this.rangeCircle.setVisible(!this.rangeCircle.visible)}),e.add.existing(this)}update(e,t){if(e<this.lastFired+this.cooldown)return;const s=this.findTarget(t);s&&(this.fire(s),this.lastFired=e)}findTarget(e){let t=null,s=-1;for(const a of e)p.Math.Distance.Between(this.x,this.y,a.x,a.y)<=this.range&&a.pathIndex>s&&(s=a.pathIndex,t=a);return t}fire(e){const t=this.scene,s=t.add.circle(this.x,this.y,5,f[this.type].color);t.physics.add.existing(s),t.tweens.add({targets:s,x:e.x,y:e.y,duration:200,onComplete:()=>{s.destroy(),e.active&&(e.takeDamage(this.damage)?t.onEnemyKilled(e):this.type==="ice"&&(e.frozen=!0,t.time.delayedCall(2e3,()=>{e.active&&(e.frozen=!1)})))}})}}class M extends p.Scene{gold=50;lives=20;wave=1;score=0;enemies=[];towers=[];waveInProgress=!1;enemiesToSpawn=[];spawnTimer=null;selectedTowerType="cannon";isPlacing=!1;placementGraphics;onStatsUpdate;onGameOver;constructor(e,t){super("TowerDefenseScene"),this.onStatsUpdate=e,this.onGameOver=t}create(){this.drawMap(),this.placementGraphics=this.add.graphics(),this.input.on("pointermove",e=>{if(this.isPlacing){const t=Math.floor(e.x/i)*i,s=Math.floor(e.y/i)*i;this.placementGraphics.clear(),this.placementGraphics.lineStyle(2,16777215),this.placementGraphics.strokeRect(t,s,i,i);const a=f[this.selectedTowerType].range;this.placementGraphics.lineStyle(1,16777215,.5),this.placementGraphics.strokeCircle(t+i/2,s+i/2,a)}}),this.input.on("pointerdown",e=>{if(this.isPlacing){const t=Math.floor(e.x/i),s=Math.floor(e.y/i);this.tryPlaceTower(t,s)}})}drawMap(){const e=this.add.graphics();e.fillStyle(1450302),e.fillRect(0,0,m,u),e.lineStyle(1,3356262,.3);for(let t=0;t<=w;t++)e.moveTo(t*i,0),e.lineTo(t*i,u);for(let t=0;t<=v;t++)e.moveTo(0,t*i),e.lineTo(m,t*i);e.strokePath(),e.fillStyle(9139029),h.forEach(t=>{e.fillRect(t.x*i,t.y*i,i,i)})}update(e,t){for(let s=this.enemies.length-1;s>=0;s--){const a=this.enemies[s];a.update(e,t),a.pathIndex>=h.length-1&&(this.lives--,this.onStatsUpdate(this.gold,this.lives,this.wave,this.score),a.destroy(),this.enemies.splice(s,1),this.lives<=0&&(this.onGameOver(this.score),this.scene.pause()))}this.towers.forEach(s=>s.update(e,this.enemies)),this.waveInProgress&&this.enemies.length===0&&this.enemiesToSpawn.length===0&&(this.waveInProgress=!1,this.gold+=this.wave*10,this.onStatsUpdate(this.gold,this.lives,this.wave,this.score))}startWave(){if(this.waveInProgress)return;this.waveInProgress=!0;const e=5+Math.floor(this.wave*1.5);for(let t=0;t<e;t++){let s="normal";this.wave>2&&Math.random()<.3&&(s="fast"),this.wave>4&&Math.random()<.2&&(s="tank"),this.wave>6&&Math.random()<.1&&(s="boss"),this.enemiesToSpawn.push(s)}this.spawnTimer=this.time.addEvent({delay:1e3,callback:this.spawnEnemy,callbackScope:this,repeat:e-1})}spawnEnemy(){const e=this.enemiesToSpawn.shift();if(e){const t=new j(this,e,1+this.wave*.2);this.enemies.push(t)}}onEnemyKilled(e){this.gold+=e.bounty,this.score+=e.bounty*10,this.onStatsUpdate(this.gold,this.lives,this.wave,this.score);const t=this.enemies.indexOf(e);t>-1&&this.enemies.splice(t,1)}setPlacementMode(e){this.selectedTowerType=e,this.isPlacing=!0}tryPlaceTower(e,t){if(e<0||e>=w||t<0||t>=v||h.some(n=>n.x===e&&n.y===t)||this.towers.some(n=>Math.floor(n.x/i)===e&&Math.floor(n.y/i)===t))return;const s=f[this.selectedTowerType].cost;if(this.gold<s)return;this.gold-=s;const a=new E(this,e,t,this.selectedTowerType);this.towers.push(a),this.onStatsUpdate(this.gold,this.lives,this.wave,this.score),this.isPlacing=!1,this.placementGraphics.clear()}}const R=()=>{const[l,e]=y.useState("start"),[t,s]=y.useState({gold:50,lives:20,wave:1,score:0}),a=y.useRef(null),n=y.useRef(null);y.useEffect(()=>{if(l==="playing"){const r=new M((x,g,S,T)=>s({gold:x,lives:g,wave:S,score:T}),x=>{s(g=>({...g,score:x})),e("gameover")});n.current=r;const d={type:p.AUTO,width:m,height:u,parent:"phaser-game",backgroundColor:"#16213e",physics:{default:"arcade",arcade:{debug:!1}},scene:r};return a.current=new p.Game(d),()=>{a.current&&(a.current.destroy(!0),a.current=null)}}},[l]);const c=()=>{s({gold:50,lives:20,wave:1,score:0}),e("playing")};return o.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px",background:"#0f172a",minHeight:"100dvh",color:"white"},children:[l==="start"&&o.jsx(b,{title:"ðŸ° Tower Defense",description:"Defiende el camino de las hordas enemigas",instructions:[{title:"Construir",items:["Selecciona una torre y haz click en el mapa"],icon:"ðŸ—ï¸"},{title:"Sobrevivir",items:["Evita que los enemigos lleguen al final"],icon:"ðŸ›¡ï¸"}],onStart:c}),l==="gameover"&&o.jsx(C,{score:t.score,onRestart:c,onMenu:()=>e("start")}),l==="playing"&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{style:{display:"flex",gap:"20px",marginBottom:"10px",fontSize:"1.2rem",fontWeight:"bold",background:"rgba(255,255,255,0.1)",padding:"10px",borderRadius:"8px"},children:[o.jsxs("span",{children:["ðŸ’° ",t.gold]}),o.jsxs("span",{children:["â¤ï¸ ",t.lives]}),o.jsxs("span",{children:["ðŸŒŠ ",t.wave]}),o.jsxs("span",{children:["â­ ",t.score]}),o.jsx("button",{onClick:()=>n.current?.startWave(),style:{background:"#4CAF50",border:"none",color:"white",padding:"5px 15px",borderRadius:"4px",cursor:"pointer"},children:"Siguiente Oleada"})]}),o.jsxs("div",{style:{display:"flex",gap:"20px"},children:[o.jsx("div",{id:"phaser-game",style:{border:"2px solid #444",borderRadius:"8px",overflow:"hidden"}}),o.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",background:"rgba(255,255,255,0.05)",padding:"20px",borderRadius:"8px"},children:[o.jsx("h3",{children:"Torres"}),Object.entries(f).map(([r,d])=>o.jsxs("button",{onClick:()=>n.current?.setPlacementMode(r),style:{padding:"10px",background:`rgba(${d.color>>16}, ${d.color>>8&255}, ${d.color&255}, 0.5)`,border:"1px solid white",color:"white",cursor:"pointer",textAlign:"left"},children:[o.jsx("div",{children:d.name}),o.jsxs("div",{style:{fontSize:"0.8em"},children:["Coste: ",d.cost]})]},r))]})]})]})]})};export{R as default};
