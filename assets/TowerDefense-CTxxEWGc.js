import{r as m,j as y}from"./index-Ctfk8T5L.js";import{A as I,G as g,T as X,a as v}from"./HTMLText-BG97J-0P.js";const b=12,F=8,n=48,h=[{x:0,y:3},{x:1,y:3},{x:2,y:3},{x:3,y:3},{x:4,y:3},{x:5,y:3},{x:6,y:3},{x:7,y:3},{x:8,y:3},{x:8,y:4},{x:9,y:4},{x:10,y:4},{x:11,y:4}],z=.02,_=3,G=60,R=.06,B=()=>{const E=m.useRef(null),[x,C]=m.useState(10),[f,A]=m.useState(1),[w,L]=m.useState(!1),[M,u]=m.useState(""),a=m.useRef({enemies:[],towers:[],shots:[],pendingEnemies:[],spawnTimer:0});m.useEffect(()=>{const o=new I({width:b*n,height:F*n,backgroundColor:2237226});E.current&&o.view instanceof Node&&E.current.appendChild(o.view);let p=!1;function N(){if(!p){for(let e=0;e<F;e++)for(let t=0;t<b;t++){const r=new g;r.lineStyle(1,4473924),r.beginFill(2237226),r.drawRect(0,0,n,n),r.endFill(),r.x=t*n,r.y=e*n,r.name="static",o.stage.addChild(r)}h.forEach((e,t)=>{const r=new g;r.beginFill(11184810),r.drawRect(0,0,n,n),r.endFill(),r.x=e.x*n,r.y=e.y*n,r.name="static",o.stage.addChild(r)}),a.current.towers.forEach(e=>{const t=new g;t.beginFill(1668818),t.drawCircle(n/2,n/2,n/2-6),t.endFill(),t.lineStyle(2,16777215),t.drawCircle(n/2,n/2,(n/2-6)*(1+e.level*.2)),t.x=e.x*n,t.y=e.y*n,t.name="tower",o.stage.addChild(t)}),p=!0}}function Y(){o.stage.children=o.stage.children.filter(e=>e.name==="static"||e.name==="tower")}function j(){Y(),a.current.enemies.forEach((i,c)=>{if(!i.alive)return;const l=h[Math.floor(i.pos)];if(!l)return;const d=new g;d.beginFill(16724787),d.drawCircle(n/2,n/2,n/2-8),d.endFill(),d.x=l.x*n,d.y=l.y*n,d.name="enemy",o.stage.addChild(d);const s=new g;s.beginFill(65280);const S=Math.max(0,i.hp);s.drawRect(0,0,(n-8)*(S/i.maxHp),6),s.endFill(),s.x=l.x*n+4,s.y=l.y*n+n-12,s.name="hp",o.stage.addChild(s)}),a.current.shots.forEach(i=>{const c=new g;c.beginFill(16776960),c.drawCircle(0,0,7),c.endFill(),c.x=i.x,c.y=i.y,c.name="shot",o.stage.addChild(c)});const e=new X({fill:16777215,fontSize:20,fontWeight:"bold"}),t=new v(`Oro: ${x}`,e);t.x=12,t.y=8,t.name="ui",o.stage.addChild(t);const r=new v(`Oleada: ${f}`,e);if(r.x=12,r.y=32,r.name="ui",o.stage.addChild(r),w){const i=new v("Haz clic en una celda junto al camino para poner torre (5 oro)",{fill:16773494,fontSize:16});i.x=12,i.y=56,i.name="ui",o.stage.addChild(i)}if(M){const i=new v(M,{fill:16724787,fontSize:18});i.x=12,i.y=80,i.name="ui",o.stage.addChild(i)}}N(),j();let T;function O(){if(a.current.pendingEnemies.length>0&&(a.current.spawnTimer--,a.current.spawnTimer<=0)){const e=a.current.pendingEnemies.shift();e&&a.current.enemies.push(e),a.current.spawnTimer=40}a.current.enemies.forEach(e=>{if(!e.alive)return;let t=e.pos+z;if(t>=h.length){e.alive=!1,u("¡Un enemigo ha llegado al final!");return}e.pos=t}),a.current.towers.forEach((e,t)=>{if(e.cooldown=Math.max(0,e.cooldown-1),e.cooldown===0){const r=a.current.enemies.findIndex(i=>i.alive&&W(e.x,e.y,h[Math.floor(i.pos)].x,h[Math.floor(i.pos)].y)<=_);if(r!==-1){const i=a.current.enemies[r],c=h[Math.floor(i.pos)].x*n+n/2,l=h[Math.floor(i.pos)].y*n+n/2;a.current.shots.push({x:e.x*n+n/2,y:e.y*n+n/2,tx:c,ty:l,progress:0,damage:Math.pow(2,e.level),target:r}),e.cooldown=G}}}),a.current.shots=a.current.shots.filter(e=>{e.progress+=R;const t=e.tx-e.x,r=e.ty-e.y;if(e.x+=t*R,e.y+=r*R,Math.abs(t)<8&&Math.abs(r)<8){const i=a.current.enemies[e.target];return i&&i.alive&&(i.hp-=e.damage),!1}return!0}),a.current.enemies.forEach(e=>{e.hp<=0&&e.alive&&(C(t=>t+f),e.alive=!1)}),j(),T=requestAnimationFrame(O)}T=requestAnimationFrame(O);function W(e,t,r,i){return Math.sqrt((e-r)**2+(t-i)**2)}function H(e){if(!w||!(o.view instanceof HTMLCanvasElement))return;const t=o.view.getBoundingClientRect(),r=e.clientX-t.left,i=e.clientY-t.top,c=Math.floor(r/n),l=Math.floor(i/n);if(!h.some(s=>Math.abs(s.x-c)+Math.abs(s.y-l)===1)){u("Solo puedes poner torres junto al camino");return}if(a.current.towers.some(s=>s.x===c&&s.y===l)){u("Ya hay una torre ahí");return}if(x<5){u("No tienes suficiente oro");return}a.current.towers.push({x:c,y:l,level:1,cooldown:0}),C(s=>s-5),u(""),L(!1)}function P(e){if(!(o.view instanceof HTMLCanvasElement))return;const t=o.view.getBoundingClientRect(),r=e.clientX-t.left,i=e.clientY-t.top,c=Math.floor(r/n),l=Math.floor(i/n),d=a.current.towers.findIndex(s=>s.x===c&&s.y===l);if(d!==-1){const s=Math.pow(2,a.current.towers[d].level)*5;if(x<s){u("No tienes suficiente oro para mejorar");return}a.current.towers[d].level+=1,C(S=>S-s),u("Torre mejorada")}}return o.view instanceof HTMLCanvasElement&&(o.view.addEventListener("pointerdown",H),o.view.addEventListener("pointerup",P)),()=>{o.view instanceof HTMLCanvasElement&&(o.view.removeEventListener("pointerdown",H),o.view.removeEventListener("pointerup",P)),cancelAnimationFrame(T),o.destroy(!0,{children:!0})}},[w,x,f,M]);function D(){const o=[];for(let p=0;p<f*2;p++)o.push({pos:0,hp:f+1,maxHp:f+1,alive:!0});a.current.pendingEnemies=o,a.current.spawnTimer=0,a.current.enemies=[],A(f+1),u("")}return m.useEffect(()=>{a.current.enemies.length>0&&a.current.enemies.every(o=>!o.alive)&&u("¡Oleada completada!")},[x,f]),y.jsxs("div",{children:[y.jsx("div",{ref:E,style:{width:b*n,height:F*n,margin:"auto"}}),y.jsxs("div",{style:{textAlign:"center",marginTop:16},children:[y.jsx("button",{onClick:()=>L(!0),disabled:w||x<5,style:{marginRight:8},children:w?"Haz clic en el mapa...":"Colocar torre (5 oro)"}),y.jsx("button",{onClick:D,disabled:a.current.enemies.some(o=>o.alive),children:"Iniciar oleada"})]})]})};export{B as default};
